<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The theory of the online update algorithms • sport</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The theory of the online update algorithms">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sport</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sport_in_r.html">sport an R package for online update algorithms</a>
    </li>
    <li>
      <a href="../articles/the_theory.html">The theory of the online update algorithms</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/gogonzo/sport">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>The theory of the online update algorithms</h1>
                        <h4 class="author">Dawid Kałędkowski</h4>
            
            <h4 class="date">2020-01-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gogonzo/sport/blob/master/vignettes/the_theory.Rmd"><code>vignettes/the_theory.Rmd</code></a></small>
      <div class="hidden name"><code>the_theory.Rmd</code></div>

    </div>

    
    
<div id="theory" class="section level1">
<h1 class="hasAnchor">
<a href="#theory" class="anchor"></a>Theory</h1>
<p>Problem of sport matchups falls into subject of paired comparison modeling and choice modeling. Estimating player skills is equivalent to estimating preference of choice between two alternatives. Just as one product is more preferred over another to buy, similarly, better player is more preferred to win over worst. As player/event and alternative/experiment can be used interchangeably, for ease of use sport nomenclature is adapted (player/event).</p>
<p>Algorithms implemented in a <code>sport</code> package performs similarly, as all using Bayesian Approximation Method. Algorithms works as follows: At some moment player <code>p</code> competes with player <code>q</code> while both have prior <span class="math inline">\(R_p\)</span> and <span class="math inline">\(R_q\)</span> ratings. Prior to event, probability that player <code>p</code> win over player <code>q</code> is <span class="math inline">\(\hat{Y_{pq}}\)</span>. After event occurs, true result <span class="math inline">\(Y_{pq}\)</span> is observed, and initial believes about rating is changed <span class="math inline">\(R_p^{'} \leftarrow R_q\)</span> according to the prediction error <span class="math inline">\((Y_{pq} - \hat{Y_{pq}} )\)</span> and some constant <span class="math inline">\(K\)</span>. Updates are summed as player can compete with more than one player in particular event.</p>
<p><span class="math display">\[\large R_p^{'} \leftarrow R_p + \sum_{q \neq p}{ K * (Y_{pq} - \hat{Y_{pq}}} )\]</span> Where: <span class="math display">\[\large \hat{Y} = P(X_i &gt; X_j)\]</span> <span class="math display">\[K - learning rate\]</span></p>
<p>Outcome probability function is based on <a href="https://en.wikipedia.org/wiki/Bradley%E2%80%93Terry_model">Bradley-Terry model</a> designed to predict outcome of pairwise comparison. For multi-player matchups where output is a ranking, <code>sport</code> package uses the same data transformation as in <a href="https://www.jstor.org/stable/270983">exploded logit</a> - ranking is then presented as combination of all possible pairs competing within same event.</p>
<div id="glicko-rating-system" class="section level2">
<h2 class="hasAnchor">
<a href="#glicko-rating-system" class="anchor"></a>Glicko rating system</h2>
<p>Glicko is the first bayesian online update algorithm incorporating rating volatility to rating and outcome computation. Glicko system is not balanced, and sum of rating rewards of all players are not zero. In one 2-players event, reward of player <code>i</code> differs from reward of player <code>q</code> as it depends on their individual ratings deviation. Rating values oscillates around <code>r=1500</code> with max deviation <code>rd&lt;=350</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(sport)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># example taken from Glickman (1999)</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">data &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">id =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb1-5" data-line-number="5">                   <span class="dt">name =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>), </a>
<a class="sourceLine" id="cb1-6" data-line-number="6">                   <span class="dt">rank =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">r &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1500</span>, <span class="dv">1400</span>, <span class="dv">1550</span>, <span class="dv">1700</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>))</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">rd &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">200</span>, <span class="dv">30</span>, <span class="dv">100</span>, <span class="dv">300</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>))</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/glicko_run.html">glicko_run</a></span>(rank <span class="op">|</span><span class="st"> </span>id <span class="op">~</span><span class="st"> </span><span class="kw">team</span>(name), <span class="dt">data =</span> data, <span class="dt">r =</span> r, <span class="dt">rd =</span> rd)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(model<span class="op">$</span>final_r)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt;        A        B        C        D </span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; 1464.297 1396.039 1606.521 1674.836</span></a></code></pre></div>
<p>For deeper knowledge read <a href="http://www.glicko.net/research/glicko.pdf">Mark E. Glickman (1999)</a>.</p>
<p>Update Rules:</p>
<p><span class="math display">\[\hat{Y_{ij}} = P(X_i&gt;X_j) = \frac{1}{ 1 + 10^{-g(RD_{ij}) * (R_i-R_j)/400}}\]</span></p>
<p><span class="math display">\[{R'}_i = R_i + \frac{1}{\frac{1}{{RD}^2_{i}} + \frac{1}{d^2_i}} * \sum_j{g(RD_j) * (Y_{ij} - \hat{Y_{ij}}) }\]</span></p>
<p><span class="math display">\[{RD'}_i = \sqrt{(\frac{1}{{RD}^2_{i}} + \frac{1}{d^2_i}})^{-1}\]</span></p>
</div>
<div id="glicko2-rating-system" class="section level2">
<h2 class="hasAnchor">
<a href="#glicko2-rating-system" class="anchor"></a>Glicko2 rating system</h2>
<p>Glicko2 improved predecessor by adding volatile parameter <span class="math inline">\(\sigma_i\)</span> which increase/decrease rating deviation in periods when player performance differs from expected. Sigma is estimated iteratively using Illinois algorithm, which converges quickly not affecting computation time. Rating values oscillates around <code>r=1500</code> with max deviation <code>rd&lt;=350</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># example taken from Glickman (2013)</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">data &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">id =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb2-3" data-line-number="3">                   <span class="dt">name =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>), </a>
<a class="sourceLine" id="cb2-4" data-line-number="4">                   <span class="dt">rank =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">r &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1500</span>, <span class="dv">1400</span>, <span class="dv">1550</span>, <span class="dv">1700</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>))</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">rd &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">200</span>, <span class="dv">30</span>, <span class="dv">100</span>, <span class="dv">300</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>))</a>
<a class="sourceLine" id="cb2-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/glicko2_run.html">glicko2_run</a></span>(rank <span class="op">|</span><span class="st"> </span>id <span class="op">~</span><span class="st"> </span><span class="kw">team</span>(name), <span class="dt">data =</span> data, <span class="dt">r =</span> r, <span class="dt">rd =</span> rd)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(model<span class="op">$</span>final_r)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt;        A        B        C        D </span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; 1468.919 1396.836 1606.055 1601.161</span></a></code></pre></div>
<p>** write about modification of g_phi **</p>
<p>For further knowledge read <a href="http://www.glicko.net/glicko/glicko2.pdf">Mark E. Glickman (2013)</a></p>
<p><span class="math display">\[ \hat{Y_{ij}} = \frac{1}{1 + e^{-g(\phi_{ij})*(\mu_i - \mu_j)} }\]</span></p>
<p><span class="math display">\[ {\phi'}_i = \frac{1}{\sqrt{ \frac{1}{ { {\phi_i}^2 + {\sigma'_i}^2}} + \frac{1}{v} }}\]</span></p>
<p><span class="math display">\[ {\mu'_i} = \mu_i + {\phi'}_i * \sum_j{g(\phi_j)*(Y_{ij} - \hat{Y_{ij}})} \]</span></p>
</div>
<div id="bayesian-bradley-terry" class="section level2">
<h2 class="hasAnchor">
<a href="#bayesian-bradley-terry" class="anchor"></a>Bayesian Bradley Terry</h2>
<p>The fastest algorithm with simple formula. Original BT formula lacks variance parameter, and this method incorporates rating deviation into model. BBT also prevents against fast <code>rd</code> decline to zero using <code>gamma</code> and <code>kappa</code>.</p>
<p>For further knowledge read <a href="http://jmlr.csail.mit.edu/papers/volume12/weng11a/weng11a.pdf">Ruby C. Weng and Chih-Jen Lin (2011)</a></p>
<p><span class="math display">\[\hat{Y_{ij}} = P(X_i&gt;X_j) = \frac{e^{R_i/c_{i_j}}}{e^{R_i/c_{ij}} + e^{R_j/c_{ij}}} \]</span></p>
<p><span class="math display">\[{R'}_i = R_i + \sum_j{\frac{RD_i^2}{c_{ij}}*(Y_{ij} - \hat{Y_{ij}})}\]</span></p>
<p><span class="math display">\[{RD'}_i = RD_i * [ 1 - \frac{RD_{ij}^2}{RD_i^2}\sum_j{ \gamma_j * (\frac{RD_i}{c_{ij}})^2* \hat{Y_{ij}}\hat{Y_{ji}} } ]\]</span></p>
</div>
<div id="dynamic-bayesian-logit" class="section level2">
<h2 class="hasAnchor">
<a href="#dynamic-bayesian-logit" class="anchor"></a>Dynamic Bayesian Logit</h2>
<p>Following algorithm gives some advantages over mentioned rating systems, adding other important factors to estimation process making final ratings unbiased. Algorithm perform better in disciples where other variables can make a difference in result eg. home field advantage. DBL implements Extended Kalman Filter learning rule, and allows to estimate multiple parameters in addition to player ratings. DBL is a Dynamic Logit extended to usage in pairwise comparisons by modeling differences in players characteristics. Classic Bradley-Terry model is enriched by moderation element <span class="math inline">\(K(s_t)\)</span> which adds prior uncertainty to output prediction.</p>
<p><span class="math display">\[\hat{Y_{ij}} = \frac{ e^{-K(s_t)w _t^T(x_{it}-x_{jt})} }{1+e^{-K(s_t)w _t^T(x_{it}-x_{jt})}}\]</span> Parameters for player <code>i</code> competing with player <code>j</code> are estimated using EKF update rule. <span class="math display">\[\hat{\omega}_{it} = \hat{\omega}_{i(t-1)} + \frac{RD^2_{i(t-1)}}{1+\hat{Y_{ij}} (1-\hat{Y_{ij}})} x_t (Y_{ij} - \hat{Y_{ij}})\]</span> <span class="math display">\[RD^2_{i t} = RD^2_{i(t-1)} - \frac{\hat{Y_{ij}}(1-\hat{Y_{ij}})}{1+\hat{Y_{ij}} (1-\hat{Y_{ij}})s_t^2}(RD^2_{i(t-1)}x_i)(RD^2_{i(t-1)}x_i)^T\]</span></p>
<p>For further knowledge read <a href="https://www.researchgate.net/publication/2465226_Dynamic_Logistic_Regression">Stephen J. Roberts, William Penny (2011)</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#theory">Theory</a><ul class="nav nav-pills nav-stacked">
<li><a href="#glicko-rating-system">Glicko rating system</a></li>
      <li><a href="#glicko2-rating-system">Glicko2 rating system</a></li>
      <li><a href="#bayesian-bradley-terry">Bayesian Bradley Terry</a></li>
      <li><a href="#dynamic-bayesian-logit">Dynamic Bayesian Logit</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Dawid Kałędkowski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
